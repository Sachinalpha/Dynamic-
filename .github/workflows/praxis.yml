name: Simple Praxis Test 

on:
  workflow_dispatch:

jobs:
  praxis:
    runs-on: windows-latest   # PowerShell default on Windows runners

    steps:
      - name: Call Praxis DevOps Specialist
        shell: pwsh
        run: |
          # Minimal pipeline as a single-line string
          $pipeline = "jobs: { test: { 'runs-on': 'windows-latest', steps: [ { run: 'Write-Output Hello, world!' } ] } }"

          # Call Praxis
          $response = Invoke-RestMethod -Uri $env:PRAXIS_BASE_URL/agents/execute `
            -Method Post `
            -Headers @{ Authorization = "Bearer $env:PRAXIS_API_TOKEN"; "Content-Type" = "application/json" } `
            -Body (@{
                agent = $env:PRAXIS_AGENT_ID
                input = "Analyze this GitHub Actions pipeline and explain what it does: $pipeline"
            } | ConvertTo-Json -Compress)

          Write-Host "=== Praxis Response ==="
          Write-Host $response
        env:
          PRAXIS_API_TOKEN: ${{ secrets.PRAXIS_API_TOKEN }}
          PRAXIS_AGENT_ID: ${{ secrets.PRAXIS_AGENT_ID }}
          PRAXIS_BASE_URL: ${{ secrets.PRAXIS_BASE_URL }}
