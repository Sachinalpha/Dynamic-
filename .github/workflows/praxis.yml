name: Praxis Agent Test 

on:
  workflow_dispatch: 

jobs:
  praxis:
    runs-on: windows-latest

    steps:
      - name: Call Praxis DevOps Specialist
        shell: pwsh
        run: |
          # Minimal pipeline string for testing
          $pipeline = "jobs: { test: { 'runs-on': 'windows-latest', steps: [ { run: 'Write-Output Hello, world!' } ] } }"

          # Build full API URL safely
          $baseUrl = $env:PRAXIS_BASE_URL.Trim()
          $uri = "$baseUrl/agents/execute"

          # Call the Praxis agent
          $response = Invoke-RestMethod -Uri $uri `
            -Method Post `
            -Headers @{ 
                Authorization = "Bearer $env:PRAXIS_API_TOKEN"
                "Content-Type" = "application/json"
            } `
            -Body (@{
                agent = $env:PRAXIS_AGENT_ID
                input = "Analyze this GitHub Actions pipeline and explain what it does: $pipeline"
            } | ConvertTo-Json -Compress)

          Write-Host "=== Praxis Response ==="
          Write-Host $response
        env:
          PRAXIS_API_TOKEN: ${{ secrets.PRAXIS_API_TOKEN }}
          PRAXIS_AGENT_ID: ${{ secrets.PRAXIS_AGENT_ID }}
          PRAXIS_BASE_URL: ${{ secrets.PRAXIS_BASE_URL }}
