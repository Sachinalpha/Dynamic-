name: Simple Praxis Test

on:
  workflow_dispatch:   # allows manual run

jobs:
  praxis:
    runs-on: ubuntu-latest

    steps:
      - name: Call Praxis DevOps Specialist
        shell: bash
        run: |
          # Minimal pipeline content for testing
          PIPELINE="jobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n      - run: echo 'Hello, world!'"

          RESPONSE=$(curl -s -X POST "$PRAXIS_BASE_URL/agents/execute" \
            -H "Authorization: Bearer $PRAXIS_API_TOKEN" \
            -H "Content-Type: application/json" \
            -d "{
              \"agent\": \"$PRAXIS_AGENT_ID\",
              \"input\": \"Analyze this GitHub Actions pipeline and explain what it does:\\n\\n$PIPELINE\"
            }")

          echo "=== Praxis Response ==="
          echo "$RESPONSE"
        env:
          PRAXIS_API_TOKEN: ${{ secrets.PRAXIS_API_TOKEN }}
          PRAXIS_AGENT_ID: ${{ secrets.PRAXIS_AGENT_ID }}
          PRAXIS_BASE_URL: ${{ secrets.PRAXIS_BASE_URL }}
